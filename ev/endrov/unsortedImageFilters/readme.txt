this code can be refactored into proper plugins but this has not yet been done